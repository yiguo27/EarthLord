# 《地球新主》产品需求文档 (PRD)
**Product Requirements Document**

---

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | 地球新主 (EarthLord) |
| 版本号 | v1.0 |
| 文档版本 | 1.0 |
| 创建日期 | 2026-01-10 |
| 产品类型 | LBS生存游戏 |
| 目标平台 | iOS (全球175国) |

---

## 1. 产品概述

### 1.1 产品定位
《地球新主》是一款基于真实地理位置的多人在线生存游戏,采用"希望朋克"末日美学风格。玩家通过现实世界的步行探索来圈占领地、收集资源、建设家园、社交交易,在废土之上重建文明。

### 1.2 核心理念
- **Walk to Earn**: 步行即挖矿,现实移动产生游戏价值
- **真实地理**: 基于苹果MapKit的真实POI数据
- **社交协作**: 以物易物、频道通讯、区域社交
- **希望主题**: 不是绝望的末日,而是重建的希望

### 1.3 对标产品
- **核心玩法**: 宝可梦GO (LBS探索 + 真实地标)
- **生存机制**: 饥荒、方舟 (资源管理 + 时间衰减)
- **社交系统**: Discord (频道管理 + 群组聊天)
- **商业模式**: 原神 (免费+内购+订阅)

---

## 2. 目标用户

### 2.1 核心用户画像

#### 主力用户 (70%)
- **年龄**: 18-35岁
- **特征**: 喜欢运动健身、有探索欲、喜欢收集养成类游戏
- **痛点**: 运动枯燥缺乏动力、希望运动有实际收益
- **需求**: 用游戏化方式让运动变得有趣有价值

#### 次级用户 (20%)
- **年龄**: 35-50岁
- **特征**: 地理爱好者、户外运动爱好者
- **痛点**: 缺乏户外活动的社交属性
- **需求**: 在探索中结识同好、记录足迹

#### 潜在用户 (10%)
- **年龄**: 不限
- **特征**: 末日题材爱好者、策略游戏玩家
- **痛点**: 传统游戏缺乏现实联动
- **需求**: 虚实结合的沉浸式体验

### 2.2 用户规模预估
- **初期目标**: 10,000 DAU (3个月)
- **中期目标**: 100,000 DAU (1年)
- **长期目标**: 1,000,000 DAU (3年)

---

## 3. 产品核心价值

### 3.1 用户价值
1. **健康激励**: 让步行运动变得有趣有回报
2. **社交连接**: 基于位置的真实社交网络
3. **收集成就**: 满足收集欲和成就感
4. **策略深度**: 资源管理、领地经营的策略玩法

### 3.2 商业价值
1. **订阅收入**: 月卡会员系统 ($9.99-$19.99/月)
2. **内购收入**: 资源包、道具包 ($0.99-$9.99)
3. **广告收入**: 非付费用户观看激励视频
4. **数据价值**: LBS用户行为数据

---

## 4. 核心功能需求

### 4.1 功能架构图

```
┌─────────────────────────────────────────────────────────┐
│                      地球新主                             │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [账户系统]   [地图系统]   [资源系统]   [社交系统]         │
│     ↓            ↓           ↓           ↓             │
│  登录注册      GPS圈地      探索搜刮     实时聊天           │
│  用户档案      领地管理      背包管理     频道管理           │
│  成就系统      建筑系统      交易系统     PTT呼叫            │
│  付费订阅      生存体征      排行榜       消息中心           │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 4.2 第一部分: 登录与圈地系统

#### 功能1: 用户登录注册
**优先级**: P0 (必须有)

**功能描述**:
- 支持邮箱+密码注册登录
- 支持Apple ID一键登录
- 支持Google账号登录
- 自动会话管理和多设备同步

**技术实现**:
- Supabase Auth统一认证
- OAuth 2.0标准协议
- JWT Token会话管理

**验收标准**:
- [ ] 用户可以使用3种方式登录
- [ ] 登录状态可以跨设备同步
- [ ] 密码重置功能正常
- [ ] 登录失败有明确提示

---

#### 功能2: GPS圈地系统
**优先级**: P0 (核心玩法)

**功能描述**:
- 实时GPS轨迹记录
- 轨迹闭合自动形成领地多边形
- 领地合法性验证(无重叠、无作弊)
- 面积自动计算和显示

**业务规则**:
- 最小圈地面积: 500m²
- 最大圈地面积: 100,000m²
- 轨迹点间隔: 3-5米
- 闭合判定: 起点30米范围内

**技术实现**:
- MapKit原生地图
- CoreLocation定位服务
- PostGIS地理数据库
- 多边形算法(Polygon Intersection)

**验收标准**:
- [ ] GPS定位精度 ≤ 10米
- [ ] 轨迹绘制实时无延迟
- [ ] 领地面积计算准确(误差<5%)
- [ ] 重叠领地检测100%准确

---

#### 功能3: 领地管理
**优先级**: P0

**功能描述**:
- 领地列表查看
- 领地重命名
- 领地交易开关
- 领地建筑统计
- 领地状态管理(活跃/废弃)

**业务规则**:
- 30天内必须开始建设
- 90天内必须保持活跃
- 超期领地自动回收

**验收标准**:
- [ ] 领地信息实时同步
- [ ] 交易开关立即生效
- [ ] 废弃规则自动执行

---

### 4.3 第二部分: 探索与资源获取

#### 功能4: POI发现与搜刮
**优先级**: P0 (核心循环)

**功能描述**:
- 自动检测附近POI(兴趣点)
- 基于POI类型分配资源
- 搜刮冷却时间机制
- 探索距离和时长统计

**POI类型与资源对应**:

| POI类型 | 主要产出 | 稀有产出 |
|---------|---------|---------|
| 医院/药店 | 药品、绷带 | 抗生素、急救包 |
| 超市/餐厅 | 罐头、水 | 高级食材 |
| 工厂/工地 | 金属、钢材 | 稀有合金 |
| 公园/林地 | 木材、布料 | 种子 |
| 银行/珠宝店 | 稀有材料 | 电子元件 |

**技术实现**:
- MapKit POI Search
- 地理围栏 (Geofencing)
- 随机掉落算法

**验收标准**:
- [ ] POI识别准确率 > 95%
- [ ] 进入范围50米内触发
- [ ] 掉落物符合概率分布
- [ ] 冷却时间准确(12小时)

---

#### 功能5: 背包系统
**优先级**: P0

**功能描述**:
- 物品分类管理
- 容量限制(初始100格)
- 物品使用和消耗
- 物品数量统计

**技术实现**:
- 本地优先架构(Local-First)
- SQLite本地存储
- Supabase云端同步

**验收标准**:
- [ ] 离线状态可查看背包
- [ ] 网络恢复自动同步
- [ ] 物品数量准确无误差

---

### 4.4 第三部分: 建造与交易系统

#### 功能6: 建造系统
**优先级**: P0

**功能描述**:
- 15种建筑可建造
- 4大类别: 生存/储存/生产/能源
- 3个等级: Tier 1/2/3
- 资源消耗验证
- 建筑位置拖放

**建筑清单**:

| 类别 | Tier 1 | Tier 2 | Tier 3 |
|------|--------|--------|--------|
| 生存 | 篝火、帐篷 | 木屋、炉灶 | 钢筋房屋 |
| 储存 | 小仓库 | 中仓库 | 大仓库 |
| 生产 | 工作台 | 农田 | 工厂 |
| 能源 | 太阳能板 | 风力发电 | 核能发电 |

**技术实现**:
- 建筑模板系统(Template Pattern)
- 资源检查和扣除
- 地图图标渲染

**验收标准**:
- [ ] 资源不足时无法建造
- [ ] 建筑图标正确显示在地图
- [ ] 建造后资源正确扣除

---

#### 功能7: 建筑状态管理
**优先级**: P1

**功能描述**:
- 5种状态: 建造中/待激活/运行中/损坏/废弃
- 状态转换规则
- 升级功能
- 维修功能

**状态机设计**:
```
建造中 → 待激活 → 运行中 ⇄ 损坏
                      ↓
                    废弃
```

**验收标准**:
- [ ] 状态流转符合规则
- [ ] 只能对运行中建筑升级
- [ ] 损坏建筑需要维修

---

#### 功能8: 交易系统
**优先级**: P1

**功能描述**:
- 玩家发布交易挂单
- 基于位置的交易发现(100米内)
- 以物易物机制
- 交易历史记录

**业务规则**:
- 只能在对方领地100米内看到挂单
- 交易双方资源同时扣除/增加
- 交易不可撤销

**验收标准**:
- [ ] 距离判定准确
- [ ] 资源交换原子性(要么都成功,要么都失败)
- [ ] 交易记录可查询

---

### 4.5 第四部分: 通讯系统

#### 功能9: 消息中心
**优先级**: P1

**功能描述**:
- 官方消息推送
- 系统通知
- 每日任务提醒
- 生存指南

**验收标准**:
- [ ] 消息分类清晰
- [ ] 新消息有红点提示
- [ ] 历史消息可查看

---

#### 功能10: 公共频道聊天
**优先级**: P1

**功能描述**:
- 基于位置的公共聊天室
- 覆盖范围3km
- 实时消息推送
- 消息历史记录

**技术实现**:
- Supabase Realtime
- WebSocket长连接
- 地理范围过滤

**验收标准**:
- [ ] 消息延迟 < 1秒
- [ ] 只显示3km内玩家消息
- [ ] 支持文字和表情

---

#### 功能11: 频道管理
**优先级**: P2

**功能描述**:
- 创建私人频道
- 加入/退出频道
- 频道列表查看
- 频道在线人数

**验收标准**:
- [ ] 频道成员管理正常
- [ ] 退出频道后看不到消息
- [ ] 在线人数实时更新

---

#### 功能12: PTT呼叫
**优先级**: P2

**功能描述**:
- 长按说话,松开发送
- 语音转文字
- 频率选择

**验收标准**:
- [ ] PTT交互流畅
- [ ] 语音识别准确率 > 90%
- [ ] 频率切换正常

---

#### 功能13: 设备等级系统
**优先级**: P2

**功能描述**:
- 4级设备: 收音机 → 对讲机 → 营地电台 → 卫星通讯
- 功能逐级解锁
- 覆盖范围递增

**设备对比**:

| 设备 | 功能 | 范围 | 解锁条件 |
|------|------|------|---------|
| 收音机 | 只能接收 | - | 初始 |
| 对讲机 | 可收发 | 3km | 付费/$资源 |
| 营地电台 | 可收发+频道 | 10km | 付费/$资源 |
| 卫星通讯 | 全功能 | 全球 | VIP专属 |

**验收标准**:
- [ ] 低级设备功能受限
- [ ] 升级后功能正常解锁

---

### 4.6 第五部分: 个人中心与商业化

#### 功能14: 个人主页
**优先级**: P0

**功能描述**:
- 玩家档案展示
- 存活天数统计
- 领地数量和面积
- 建筑统计
- 成就展示

**验收标准**:
- [ ] 数据统计准确
- [ ] 实时更新

---

#### 功能15: 多语言设置
**优先级**: P1

**功能描述**:
- 支持简体中文/繁体中文/英文
- 一键切换
- 重启应用生效

**技术实现**:
- iOS Localizable.strings
- 动态语言切换

**验收标准**:
- [ ] 所有文案完整翻译
- [ ] 切换后无乱码
- [ ] 用户选择可持久化

---

#### 功能16: 付费订阅系统
**优先级**: P0 (变现核心)

**功能描述**:
- 订阅制: 月卡/季卡/年卡
- 一次性购买: 资源包
- 自动续费管理
- 家庭共享支持

**定价策略**:

| 商品 | 价格 | 权益 |
|------|------|------|
| 开拓者月卡 | $9.99/月 | 探索无限次、范围+50% |
| 领主通行证 | $19.99/月 | 全部特权+专属皮肤 |
| 初级物资包 | $0.99 | 基础资源×50 |
| 中级物资包 | $2.99 | 稀有资源×20 |
| 高级物资包 | $9.99 | 传说资源×5 |

**技术实现**:
- StoreKit 2 API
- 服务器端收据验证
- 订阅状态同步

**验收标准**:
- [ ] 支付流程顺畅
- [ ] 收据验证100%准确
- [ ] 权益立即生效
- [ ] 自动续费正常

---

#### 功能17: 排行榜
**优先级**: P1

**功能描述**:
- 3个榜单: 领地面积/探索废墟/建筑数量
- 显示前100名
- 显示自己排名
- 每日/周/月榜单

**技术实现**:
- 数据库窗口函数(RANK OVER)
- Redis缓存(5分钟刷新)

**验收标准**:
- [ ] 排名计算准确
- [ ] 查询速度 < 500ms
- [ ] 缓存机制生效

---

#### 功能18: 成就系统
**优先级**: P1

**功能描述**:
- 40+成就任务
- 4个稀有度: 普通/稀有/史诗/传说
- 金币奖励
- 进度追踪

**成就示例**:

| 成就名称 | 条件 | 奖励 | 稀有度 |
|---------|------|------|-------|
| 新手领主 | 完成第一次圈地 | 100金币 | 普通 |
| 末世拾荒者 | 完成第一次搜刮 | 100金币 | 普通 |
| 建筑大师 | 建造10个建筑 | 500金币 | 稀有 |
| 领地霸主 | 领地总面积>10万m² | 2000金币 | 史诗 |
| 全球开拓者 | 在5个国家圈地 | 10000金币 | 传说 |

**技术实现**:
- EventBus事件总线
- 发布-订阅模式

**验收标准**:
- [ ] 成就触发准确
- [ ] 奖励正确发放
- [ ] 进度实时更新

---

#### 功能19: 生存体征系统
**优先级**: P2

**功能描述**:
- 3个指标: 核心生命/饱食度/水分
- 时间自动衰减
- 低于阈值有负面效果
- 高于阈值有增益

**衰减规则**:
- 饱食度: -5/小时
- 水分: -10/小时
- 生命值: 饱食度或水分<20时 -1/分钟

**增益规则**:
- 饱食度>80 且 水分>80: 探索效率+20%

**验收标准**:
- [ ] 衰减计算准确
- [ ] 增益/负面效果生效
- [ ] 使用食物/水正确恢复

---

## 5. 非功能需求

### 5.1 性能需求

| 指标 | 要求 |
|------|------|
| App启动时间 | < 3秒 |
| 地图加载时间 | < 2秒 |
| GPS定位延迟 | < 1秒 |
| 消息发送延迟 | < 500ms |
| 接口响应时间 | < 1秒 |
| 崩溃率 | < 0.1% |
| 帧率 | ≥ 60 FPS |

### 5.2 兼容性需求
- iOS版本: iOS 16.0+
- 设备: iPhone 8及以上
- 屏幕: 支持所有iPhone屏幕尺寸
- 网络: 支持4G/5G/WiFi, 弱网可用

### 5.3 安全需求
- 用户密码加密存储(bcrypt)
- API通信HTTPS加密
- JWT Token过期机制
- 防作弊检测(GPS速度检测)
- 敏感信息脱敏

### 5.4 可用性需求
- 离线模式: 查看背包、领地等基础功能
- 断网重连: 自动重连,数据同步
- 弱网优化: 降级策略,优先保证核心功能

---

## 6. 技术架构

### 6.1 技术栈

**前端**:
- SwiftUI (iOS原生UI框架)
- MapKit (地图服务)
- CoreLocation (定位服务)
- StoreKit 2 (支付系统)
- Combine (响应式编程)

**后端**:
- Supabase (BaaS服务)
  - PostgreSQL + PostGIS (数据库)
  - Supabase Auth (认证)
  - Supabase Realtime (实时通讯)
  - Supabase Storage (文件存储)

**第三方服务**:
- Apple Sign In (OAuth登录)
- Google Sign In (OAuth登录)
- App Store Connect (发布)

### 6.2 数据库设计 (核心表)

```sql
-- 用户表
users (
  id UUID PRIMARY KEY,
  email TEXT,
  username TEXT,
  created_at TIMESTAMP
)

-- 领地表
territories (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users,
  name TEXT,
  geometry GEOMETRY(POLYGON),
  area FLOAT,
  created_at TIMESTAMP
)

-- 建筑表
buildings (
  id UUID PRIMARY KEY,
  territory_id UUID REFERENCES territories,
  type TEXT,
  status TEXT,
  tier INT,
  position GEOMETRY(POINT)
)

-- 物品表
items (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users,
  item_type TEXT,
  quantity INT
)

-- 交易表
trades (
  id UUID PRIMARY KEY,
  owner_id UUID REFERENCES users,
  offer_item TEXT,
  request_item TEXT,
  status TEXT,
  location GEOMETRY(POINT)
)

-- 消息表
messages (
  id UUID PRIMARY KEY,
  channel_id UUID,
  user_id UUID REFERENCES users,
  content TEXT,
  created_at TIMESTAMP
)
```

---

## 7. 商业化策略

### 7.1 变现模式

**1. 订阅制 (预计占60%收入)**
- 开拓者月卡: $9.99/月
- 领主通行证: $19.99/月
- 转化率目标: 3-5%

**2. 内购 (预计占35%收入)**
- 资源包: $0.99-$9.99
- 建筑皮肤: $1.99-$4.99
- 专属道具: $2.99-$9.99

**3. 广告 (预计占5%收入)**
- 激励视频: 观看广告获得资源
- 展示广告: 非付费用户

### 7.2 收入预测

**保守估算 (第一年)**:
- DAU: 10,000
- 付费率: 3%
- ARPPU: $15/月
- 月收入: 10,000 × 3% × $15 = $4,500
- 年收入: $54,000

**理想估算 (第一年)**:
- DAU: 50,000
- 付费率: 5%
- ARPPU: $20/月
- 月收入: 50,000 × 5% × $20 = $50,000
- 年收入: $600,000

### 7.3 推广策略

**ASO优化**:
- 关键词: Survival Game, Walking Game, LBS Game
- 截图: 突出核心玩法和视觉风格
- 视频: 30秒gameplay演示

**社交媒体**:
- TikTok/Instagram: 游戏实录短视频
- Reddit: r/iosgaming, r/gaming
- Discord: 官方社区

**KOL合作**:
- 游戏主播试玩
- 测评UP主推荐

---

## 8. 开发计划

### 8.1 版本规划

**v1.0 MVP (3个月)**
- 登录注册
- GPS圈地
- POI探索
- 背包管理
- 基础建造
- 公共聊天
- 付费订阅

**v1.1 社交增强 (1个月)**
- 交易系统
- 频道管理
- PTT呼叫
- 好友系统

**v1.2 深度玩法 (1个月)**
- 生存体征
- 成就系统
- 排行榜
- 每日任务

**v2.0 全球化 (2个月)**
- 多语言支持
- 全球服务器
- 跨区域玩法

### 8.2 里程碑

| 里程碑 | 时间 | 目标 |
|--------|------|------|
| Alpha测试 | M1 | 核心功能可玩 |
| Beta测试 | M2 | 100名测试用户 |
| 提审App Store | M3 | 通过审核 |
| 正式上线 | M3 | 开放下载 |
| 用户破万 | M4 | 10,000 DAU |
| 盈亏平衡 | M6 | 收入覆盖成本 |

---

## 9. 风险与对策

### 9.1 技术风险

| 风险 | 影响 | 概率 | 对策 |
|------|------|------|------|
| GPS精度不足 | 核心玩法受损 | 中 | 多重定位源+误差校正算法 |
| 后端服务宕机 | 用户无法游玩 | 低 | Supabase有99.9% SLA + 本地缓存 |
| 地理数据库性能 | 查询慢影响体验 | 中 | 空间索引+缓存优化 |
| 实时消息延迟 | 聊天体验差 | 低 | WebSocket长连接+消息队列 |

### 9.2 业务风险

| 风险 | 影响 | 概率 | 对策 |
|------|------|------|------|
| 作弊刷资源 | 经济系统崩溃 | 高 | GPS速度检测+行为异常检测 |
| 付费率低 | 无法盈利 | 中 | 优化付费点设计+A/B测试 |
| 用户流失严重 | DAU下降 | 中 | 每日任务+成就系统+推送召回 |
| 竞品抄袭 | 市场份额被抢 | 高 | 快速迭代+建立品牌+社区运营 |

### 9.3 合规风险

| 风险 | 影响 | 概率 | 对策 |
|------|------|------|------|
| App Store拒审 | 无法上架 | 中 | 严格遵守审核指南+提前沟通 |
| 隐私政策违规 | 下架风险 | 低 | 符合GDPR/CCPA+隐私协议 |
| 地图数据版权 | 法律纠纷 | 低 | 使用苹果官方MapKit |

---

## 10. 成功指标 (KPI)

### 10.1 用户指标
- **DAU**: 日活跃用户数 (目标: 10,000+)
- **MAU**: 月活跃用户数 (目标: 50,000+)
- **留存率**:
  - 次日留存 > 40%
  - 7日留存 > 20%
  - 30日留存 > 10%

### 10.2 收入指标
- **付费率**: 3-5%
- **ARPPU**: $15-20/月
- **LTV**: 用户生命周期价值 > $50

### 10.3 体验指标
- **崩溃率**: < 0.1%
- **App Store评分**: > 4.5星
- **用户投诉率**: < 1%

### 10.4 社交指标
- **聊天活跃度**: 每日发送消息 > 5万条
- **交易笔数**: 每日 > 1000笔
- **频道数量**: > 500个

---

## 11. 附录

### 11.1 竞品分析

| 产品 | 类型 | 优势 | 劣势 | 我们的差异化 |
|------|------|------|------|------------|
| 宝可梦GO | LBS游戏 | IP强大、用户量大 | 玩法单一、社交弱 | 更深度的生存玩法+社交系统 |
| Ingress | LBS游戏 | 策略性强 | 学习曲线陡峭 | 更易上手的圈地玩法 |
| Zombies Run | 运动游戏 | 沉浸式叙事 | 缺乏多人互动 | 多人社交+交易系统 |
| Keep | 运动App | 用户基数大 | 游戏性弱 | 游戏化激励更强 |

### 11.2 名词解释
- **LBS**: Location Based Service, 基于位置的服务
- **POI**: Point of Interest, 兴趣点
- **PTT**: Push To Talk, 按键说话
- **DAU**: Daily Active Users, 日活跃用户
- **ARPPU**: Average Revenue Per Paying User, 付费用户平均收入
- **ASO**: App Store Optimization, 应用商店优化

---

**文档结束**
